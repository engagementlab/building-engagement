<section class="section container" *ngIf="isLoading">

  <!-- Loading spinner -->
  <svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" width="64px" height="64px" viewBox="0 0 128 128"
    xml:space="preserve">
    <rect x="0" y="0" width="100%" height="100%" fill="#FFFFFF" />
    <g>
      <circle cx="16" cy="64" r="16" fill="#000000" fill-opacity="1" />
      <circle cx="16" cy="64" r="14.344" fill="#000000" fill-opacity="1" transform="rotate(45 64 64)" />
      <circle cx="16" cy="64" r="12.531" fill="#000000" fill-opacity="1" transform="rotate(90 64 64)" />
      <circle cx="16" cy="64" r="10.75" fill="#000000" fill-opacity="1" transform="rotate(135 64 64)" />
      <circle cx="16" cy="64" r="10.063" fill="#000000" fill-opacity="1" transform="rotate(180 64 64)" />
      <circle cx="16" cy="64" r="8.063" fill="#000000" fill-opacity="1" transform="rotate(225 64 64)" />
      <circle cx="16" cy="64" r="6.438" fill="#000000" fill-opacity="1" transform="rotate(270 64 64)" />
      <circle cx="16" cy="64" r="5.375" fill="#000000" fill-opacity="1" transform="rotate(315 64 64)" />
      <animateTransform attributeName="transform" type="rotate"
        values="0 64 64;315 64 64;270 64 64;225 64 64;180 64 64;135 64 64;90 64 64;45 64 64" calcMode="discrete"
        dur="500ms" repeatCount="indefinite"></animateTransform>
    </g>
  </svg>

</section>

<section id="deny" class="section container" *ngIf="!isLoading && !allowAccess">
  Sorry, you don't have the permissions to access this page.
</section>

<div *ngIf="allowAccess && hasContent">

  <section class="section" id="producers">
    <div class="container">
      <h2 class="subtitle">Producers</h2>

      <div class="columns is-multiline">
        <div class="column is-one-half user" *ngFor="let item of users">
          <a (click)="viewProjects(item.projects)">
            <div class="card">

              <header class="card-header">
                <p class="card-header-title">{{ item.user.name }}</p>
              </header>

              <div class="card-content">
                <div class="media">
                  <div class="media-content">
                    <p>
                      <svg viewBox="0 0 16 17.707" width="16" height="17.707"
                        style="enable-background:new 0 0 490.2 490.2;">
                        <g transform="matrix(0.032929, 0, 0, 0.032929, 0, -0.000012)">
                          <g transform="matrix(1, 0, 0, 1, -2.150009, -0.000012)">
                            <path d="M420.95,61.8C376.25,20.6,320.65,0,254.25,0c-69.8,0-129.3,23.4-178.4,70.3s-73.7,105.2-73.7,175
                          c0,66.9,23.4,124.4,70.1,172.6c46.9,48.2,109.9,72.3,189.2,72.3c47.8,0,94.7-9.8,140.7-29.5c15-6.4,22.3-23.6,16.2-38.7l0,0
                          c-6.3-15.6-24.1-22.8-39.6-16.2c-40,17.2-79.2,25.8-117.4,25.8c-60.8,0-107.9-18.5-141.3-55.6c-33.3-37-50-80.5-50-130.4
                          c0-54.2,17.9-99.4,53.6-135.7c35.6-36.2,79.5-54.4,131.5-54.4c47.9,0,88.4,14.9,121.4,44.7s49.5,67.3,49.5,112.5
                          c0,30.9-7.6,56.7-22.7,77.2c-15.1,20.6-30.8,30.8-47.1,30.8c-8.8,0-13.2-4.7-13.2-14.2c0-7.7,0.6-16.7,1.7-27.1l18.6-152.1h-64
                          l-4.1,14.9c-16.3-13.3-34.2-20-53.6-20c-30.8,0-57.2,12.3-79.1,36.8c-22,24.5-32.9,56.1-32.9,94.7c0,37.7,9.7,68.2,29.2,91.3
                          c19.5,23.2,42.9,34.7,70.3,34.7c24.5,0,45.4-10.3,62.8-30.8c13.1,19.7,32.4,29.5,57.9,29.5c37.5,0,69.9-16.3,97.2-49
                          c27.3-32.6,41-72,41-118.1C488.05,152.9,465.75,103,420.95,61.8z M273.55,291.9c-11.3,15.2-24.8,22.9-40.5,22.9
                          c-10.7,0-19.3-5.6-25.8-16.8c-6.6-11.2-9.9-25.1-9.9-41.8c0-20.6,4.6-37.2,13.8-49.8s20.6-19,34.2-19c11.8,0,22.3,4.7,31.5,14.2
                          s13.8,22.1,13.8,37.9C290.55,259.2,284.85,276.6,273.55,291.9z"></path>
                          </g>
                        </g>
                      </svg>
                      &nbsp;
                      <ng-container *ngIf="item.user.email; else noEmail">
                      {{item.user.email}}
                      </ng-container>
                      <ng-template #noEmail>
                        ????
                      </ng-template>
                    </p>
                    <p>
                      <svg viewBox="0 0 16 16" width="16" height="16">
                        <g transform="matrix(0.03125 0 0 0.03125 0 0)">
                          <path
                            d="M452 40h-24V0h-40v40H124V0H84v40H60C26.9 40 0 66.9 0 100v352c0 33.1 26.9 60 60 60h392c33.1 0 60-26.9 60-60V100C512 66.9 485.1 40 452 40zM472 452c0 11-9 20-20 20H60c-11 0-20-9-20-20V188h432V452zM472 148H40v-48c0-11 9-20 20-20h24v40h40V80h264v40h40V80h24c11 0 20 9 20 20V148z" />
                          <rect x="76" y="230" width="40" height="40" />
                          <rect x="156" y="230" width="40" height="40" />
                          <rect x="236" y="230" width="40" height="40" />
                          <rect x="316" y="230" width="40" height="40" />
                          <rect x="396" y="230" width="40" height="40" />
                          <rect x="76" y="310" width="40" height="40" />
                          <rect x="156" y="310" width="40" height="40" />
                          <rect x="236" y="310" width="40" height="40" />
                          <rect x="316" y="310" width="40" height="40" />
                          <rect x="76" y="390" width="40" height="40" />
                          <rect x="156" y="390" width="40" height="40" />
                          <rect x="236" y="390" width="40" height="40" />
                          <rect x="316" y="390" width="40" height="40" />
                          <rect x="396" y="310" width="40" height="40" />
                        </g>
                      </svg>

                      &nbsp;
                      <!-- TODO: Should probably format this date a little nicer. -->
                      <ng-container *ngIf="item.user.lastLogin; else noLogin">
                        {{item.user.lastLogin}}
                      </ng-container>
                      {{item.lastetSurveyDate}}
                      <ng-template #noLogin>
                        No data
                      </ng-template></p>
                  </div>
                </div>
              </div>
            </div>
          </a>
        </div>
      </div>

      <div id="projects-modal" class="modal-wrapper">
        <div id="modal" class="modal columns is-mobile">

          <div class="no-bottom-space columns is-mobile is-multiline">
            <h2 class="no-bottom-space column is-7-mobile is-9-tablet">View Projects</h2>

            <div id="close-btn" class="column" *ngIf="!hideCloseButton">
              <a (click)="closeProjects()">
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="none" viewBox="0 0 50 50">
                  <path stroke="#000" stroke-width="1" d="M11.414 11.586l27.577 28.991M40.406 11.121L11.414 38.699" />
                </svg>
              </a>
            </div>
          </div>

          <div>
            <div *ngFor="let project of currentProjects">
              <a routerLink="/admin/{{project._id}}">{{project.name}}</a>
              <hr />
            </div>

            <div *ngIf="!hasProjects">
              <p>User does not have any projects.</p>
            </div>
          </div>

          <div class="column">

          </div>
        </div>

      </div>
    </div>
  </section>

</div>
